import nmap
from pprint import pprint

COMMON_TCP_PORTS = "22, 23, 80, 443, 554, 502, 8080, 8443, 8000"

def minimal_tcp_scan(ip, ports = None, use_syn = False):
	ports = ports or COMMON_TCP_PORTS
	nm = nmap.PortScanner()
	scan_flag = "-sS" if use_syn else "-sT"
	args = f"{scan_flag} -p {ports} -Pn -T2"
	print("Running nmap:", args, "on", ip)
	nm.scan(hosts = ip, arguments = args)
	results = {}
	for host in nm.all_hosts():
		results[host] = []
		for proto in nm[host].all_protocols():
			for port in sorted(nm[host][proto].keys()):
				p = nm[host][proto][port]
				results[host].append({
					"protocol": proto,
					"port": int(port),
					"state": p.get("state"),
					"service": p.get("name")
				})
	return results
	
if __name__ == "__main__":
	target = "127.0.0.1"
	out = minimal_tcp_scan(target, ports = "8000, 8080, 22", use_syn=False)
	pprint(out)
